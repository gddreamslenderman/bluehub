-- Script for highlighting players with a toggle feature

-- Place this script in ServerScriptService

local Players = game:GetService("Players")

-- A table to store the Highlight objects for each player
local playerHighlights = {}

-- Variable to toggle highlighting on or off
local isHighlightEnabled = true  -- Set to false to disable highlighting

-- Function to highlight a player
local function highlightPlayer(player)
    if player.Character then
        -- Create the Highlight object
        local character = player.Character
        local highlight = Instance.new("Highlight")
        highlight.Parent = character
        highlight.Name = "PlayerHighlight"  -- Name it for easy removal

        -- Customize the appearance of the highlight
        highlight.FillColor = Color3.fromRGB(255, 0, 0)  -- Red color
        highlight.OutlineColor = Color3.fromRGB(255, 0, 0)  -- Black outline
        highlight.OutlineTransparency = 0.5
        highlight.FillTransparency = 0.5
        
        -- Store the highlight in the table
        playerHighlights[player] = highlight
    end
end

-- Function to remove the highlight from a player
local function removeHighlight(player)
    if playerHighlights[player] then
        playerHighlights[player]:Destroy()
        playerHighlights[player] = nil
    end
end

-- Function to toggle highlighting on or off
local function toggleHighlighting()
    isHighlightEnabled = not isHighlightEnabled  -- Toggle the value

    -- Go through all players and either add or remove highlights
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character then
            if isHighlightEnabled then
                highlightPlayer(player)
            else
                removeHighlight(player)
            end
        end
    end
end

-- Connect to PlayerAdded and PlayerRemoving events
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if isHighlightEnabled then
            highlightPlayer(player)
        end
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    removeHighlight(player)
end)

-- Initial highlight for all players already in the game
for _, player in pairs(Players:GetPlayers()) do
    if player.Character then
        if isHighlightEnabled then
            highlightPlayer(player)
        end
    end
end

-- Create a RemoteEvent for toggling from the client (optional)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local toggleEvent = Instance.new("RemoteEvent")
toggleEvent.Name = "ToggleHighlightEvent"
toggleEvent.Parent = ReplicatedStorage

-- Listen for the toggle event from the client
toggleEvent.OnServerEvent:Connect(function(player)
    toggleHighlighting()
end)
